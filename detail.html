<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no">
    <script src="https://libs.baidu.com/jquery/1.3.2/jquery.min.js"></script>

    <title>移动采编</title>
    <!-- <link rel="shortcut icon" href="./img/hbrb.png" type="image/gif"> -->
    <STYLE TYPE="text/css">
        .div_foot {
            position: absolute;
            width: 100%;
            bottom: 10px;
            text-align: center;
        }
    </STYLE>
</head>

<body>
    <h2 style="text-align:center;">移动采编</h2>

    <div id="tip1" style="text-align: center; color:red">（请使用Safari查看原网页）</div>
    <br /><br />
    <p style="text-align: center;">
        <img id="spePic" src='./img/loadingNew.gif' width="42" height="42" hidden='YES'>
    </p>
    <a id="link1" style="font-size:20px; line-height:30px; display: block; text-align: center;" href="#" onclick="showLoading()">安装地址1</a>
    <br />
    <a id="link2" style="font-size:20px; line-height:30px; display: block; text-align: center;" href="#" onclick="showLoading()">安装地址2</a>
    <br />
    <div id="tip2" style="text-align: center; color:darkgray">（点击安装后请回到桌面等待安装完成）</div>
    <p style="text-align: center;">
        <img id="norPic" src="" width="180" height="180" />
    </p>
    <br /><br /><br /><br /><br />
    <div class="div_foot">
        <div style="text-align: center; color:darkgray; display: block; width:  auto;">
            太极计算机股份有限公司
            <br> 版权所有
        </div>
    </div>
</body>

<script>
    readParam()

    function readParam() {
        let name = getUrlParam("name")
        let flag = getUrlParam("flag")
        let type = getUrlParam("type")
        let image = getUrlParam("image")

        let showName = type == 1 ? name + "移动采编" : name

        let plistPrefix = "itms-services://?action=download-manifest&url=https://bitbucket.org/newsky/ipalist/raw/master/"

        $(document).ready(function() {
            $("title").text(showName + 'iOS')
            $("h2").text(showName + 'iOS')
            $("#link1").attr('href', plistPrefix + flag + '.plist')
            $("#link2").attr('href', plistPrefix + flag + '.plist')
            if (image == 1) {
                let src = './img/' + flag + '.png'
                    // console.log(src)
                    // $("img").attr('src', src)
                $("#norPic").attr('src', src)
            } else {
                // $("img").hide()
                $("#norPic").hide()
            }

            if (flag.length == 0) {
                $("h2").hide()
                $("#link1").hide()
                $("#link2").hide()
                $("#tip1").hide()
                $("#tip2").text('地址错误，请检查~')
            }

        });
    }

    function getUrlParam(name) {
        var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)"); //构造一个含有目标参数的正则表达式对象
        var r = window.location.search.substr(1).match(reg); //匹配目标参数
        if (r != null) return decodeURI(r[2]);
        return null; //返回参数值
    }

    function showLoading(name) {
        $("#spePic").show()
        $("#link1").hide()
        $("#link2").hide()
        setTimeout(() => {
            hideLoading()
        }, 6000);
    }

    function hideLoading() {
        $("#spePic").hide()
        $("#link1").show()
        $("#link2").show()
    }
</script>

</html>
